image: Visual Studio 2017

platform:
  - x64

environment:
  app_version: 
  nodejs_version: "12"
  github_token:
    secure: o9FnGoA7kIQPmz6pI/uzpPbOrolyu2jgAzTVV7Ld6TdbmM3pSh60UR7PU2B9FzpF

# Init (set x64 VC)
init:
  call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"

# Install scripts
install:
  # - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

  # Get the latest LTS version of Node.js 12
  - ps: Install-Product node $env:nodejs_version x64

  # Add Wix to Build Path
  - dir "c:\Program Files (x86)\WiX Toolset"*
  - set PATH="c:\Program Files (x86)\WiX Toolset v3.11\bin";%PATH%

  # Set NPM to use Visual Studio 2017
  - npm config set msvs_version "2017"
  
  # Set NPM to use Python x64
  - npm config set python "C:\\Python27-x64\\pythonw.exe"
  
  # Install Packages
  - npm install

  # Rebuild native packages
  # Install SQLite from Source (Native Module)
  - npm install sqlite3 --build-from-source --runtime=electron --target=10.1.2 --dist-url=https://electronjs.org/headers
  
build_script:
  - set PATH=C:\projects\sete\node_modules\.bin;%PATH%
  - electron-forge make

artifacts:
  - path: "\\out\\make\\squirrel.windows\\x64"
    name: WinBinaries

deploy:
  release: SETE-v$(APPVEYOR_BUILD_VERSION)
  description: 'SETE v1.0.0'
  provider: GitHub
  auth_token:
    secure: $env:github_token
  artifact: WinBinaries
  on:
    branch: master                 # release from master branch only


on_finish:
  - ECHO Exiting...
  # - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

